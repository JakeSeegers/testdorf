<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé® Tileset Sprite Picker Tool</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #1a1a1a;
            font-family: 'Courier New', monospace;
            color: #fff;
            min-height: 100vh;
        }
        
        .container {
            display: flex;
            gap: 20px;
            max-width: 1600px;
            margin: 0 auto;
        }
        
        .left-panel {
            flex: 1;
            max-width: 800px;
        }
        
        .right-panel {
            width: 350px;
            background: rgba(0,0,0,0.8);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #4CAF50;
            height: fit-content;
            position: sticky;
            top: 20px;
        }
        
        #title {
            text-align: center;
            font-size: 24px;
            margin-bottom: 20px;
            color: #4CAF50;
            text-shadow: 0 0 10px #4CAF50;
        }
        
        #tilesetCanvas {
            border: 2px solid #4CAF50;
            background: #000;
            cursor: crosshair;
            display: block;
            margin: 0 auto;
            image-rendering: pixelated;
        }
        
        .info-section {
            background: rgba(76, 175, 80, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border: 1px solid #4CAF50;
        }
        
        .info-section h3 {
            margin-top: 0;
            color: #4CAF50;
        }
        
        .coord-display {
            font-size: 18px;
            font-weight: bold;
            color: #FFD700;
            text-align: center;
            padding: 10px;
            background: rgba(255, 215, 0, 0.1);
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .preview-tile {
            width: 64px;
            height: 64px;
            border: 2px solid #4CAF50;
            margin: 10px auto;
            image-rendering: pixelated;
            background: #333;
        }
        
        .suggestions {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .sprite-suggestion {
            background: rgba(255, 255, 255, 0.05);
            padding: 8px;
            margin: 5px 0;
            border-radius: 4px;
            border-left: 3px solid #4CAF50;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .sprite-suggestion:hover {
            background: rgba(76, 175, 80, 0.2);
            transform: translateX(5px);
        }
        
        .sprite-suggestion.active {
            background: rgba(76, 175, 80, 0.3);
            border-left-color: #FFD700;
        }
        
        .sprite-name {
            font-weight: bold;
            color: #4CAF50;
        }
        
        .sprite-coord {
            color: #FFD700;
            font-size: 12px;
        }
        
        .sprite-desc {
            color: #ccc;
            font-size: 11px;
            margin-top: 2px;
        }
        
        .controls {
            margin: 15px 0;
        }
        
        input, select {
            background: #333;
            border: 1px solid #555;
            color: #fff;
            padding: 5px;
            margin: 2px;
            border-radius: 3px;
        }
        
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 12px;
            margin: 4px;
            border-radius: 4px;
            cursor: pointer;
            font-family: inherit;
        }
        
        button:hover {
            background: #45a049;
        }
        
        #codeOutput {
            background: #000;
            border: 1px solid #555;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .zoom-controls {
            text-align: center;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div id="title">üé® Tileset Sprite Picker Tool üîç</div>
    
    <div class="container">
        <div class="left-panel">
            <div class="zoom-controls">
                <label>Zoom: </label>
                <button onclick="changeZoom(0.5)">50%</button>
                <button onclick="changeZoom(1)">100%</button>
                <button onclick="changeZoom(2)">200%</button>
                <button onclick="changeZoom(3)">300%</button>
                <span id="zoomLevel">200%</span>
            </div>
            
            <canvas id="tilesetCanvas"></canvas>
            
            <div style="text-align: center; margin: 15px 0; color: #aaa;">
                üñ±Ô∏è Click on any tile to select it and see its coordinates
            </div>
        </div>
        
        <div class="right-panel">
            <div class="info-section">
                <h3>üìç Selected Tile</h3>
                <div class="coord-display" id="coordDisplay">
                    Click a tile to select
                </div>
                <canvas id="previewCanvas" class="preview-tile" width="64" height="64"></canvas>
            </div>
            
            <div class="info-section">
                <h3>‚öôÔ∏è Tileset Info</h3>
                <div id="tilesetInfo">Loading...</div>
                <div class="controls">
                    <label>Tile Size: </label>
                    <input type="number" id="tileSizeInput" value="16" min="8" max="64" onchange="updateTileSize()">
                    <br>
                    <label>Grid Offset X: </label>
                    <input type="number" id="offsetXInput" value="0" min="-32" max="32" onchange="updateOffsets()">
                    <br>
                    <label>Grid Offset Y: </label>
                    <input type="number" id="offsetYInput" value="0" min="-32" max="32" onchange="updateOffsets()">
                    <br>
                    <label>Grid: </label>
                    <input type="checkbox" id="showGridCheckbox" checked onchange="toggleGrid()"> Show Grid
                    <br>
                    <button onclick="resetAlignment()" style="font-size: 11px; padding: 4px 8px;">üéØ Auto-Align</button>
                </div>
            </div>
            
            <div class="info-section suggestions">
                <h3>üí° Sprite Suggestions</h3>
                <div id="spriteSuggestions">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
            
            <div class="info-section">
                <h3>üìã Code Output</h3>
                <button onclick="generateCode()">üîß Generate TILE_MAP Code</button>
                <textarea id="codeOutput" rows="8" readonly></textarea>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const TILESET_URL = 'https://raw.githubusercontent.com/JakeSeegers/testdorf/main/urizen_onebit_tileset__v2d0.png';
        let TILE_SIZE = 16;
        let OFFSET_X = 0;
        let OFFSET_Y = 0;
        let zoom = 2;
        let showGrid = true;
        
        // Canvas references
        let tilesetCanvas, tilesetCtx, previewCanvas, previewCtx;
        let tilesetImage = null;
        let selectedTileX = -1, selectedTileY = -1;
        let selectedSprites = new Map();
        
        // Suggested sprite locations (I'll analyze your tileset)
        const SPRITE_SUGGESTIONS = [
            // Characters - Row 0-2 area
            { name: 'DWARF_MALE', x: 0, y: 0, desc: 'Male dwarf character facing down' },
            { name: 'DWARF_FEMALE', x: 1, y: 0, desc: 'Female dwarf character' },
            { name: 'DWARF_WORKER', x: 2, y: 0, desc: 'Dwarf with tools/working' },
            { name: 'DWARF_MINER', x: 3, y: 0, desc: 'Dwarf with pickaxe' },
            
            // Terrain - Usually in top-left area
            { name: 'GRASS', x: 0, y: 10, desc: 'Grass terrain tile' },
            { name: 'DIRT', x: 1, y: 10, desc: 'Dirt/earth terrain' },
            { name: 'STONE', x: 2, y: 10, desc: 'Stone floor' },
            { name: 'WATER', x: 3, y: 10, desc: 'Water tile' },
            { name: 'TREE', x: 4, y: 10, desc: 'Tree/forest tile' },
            
            // Buildings - Usually middle area
            { name: 'HOUSE', x: 0, y: 20, desc: 'Simple house/dwelling' },
            { name: 'WORKSHOP', x: 1, y: 20, desc: 'Workshop building' },
            { name: 'MINE_ENTRANCE', x: 2, y: 20, desc: 'Mine entrance' },
            { name: 'STORAGE', x: 3, y: 20, desc: 'Storage building' },
            
            // Resources/Items - Usually scattered
            { name: 'GOLD_ORE', x: 0, y: 30, desc: 'Gold ore deposit' },
            { name: 'FOOD', x: 1, y: 30, desc: 'Food/bread' },
            { name: 'TOOLS', x: 2, y: 30, desc: 'Tools/equipment' },
            { name: 'CHEST', x: 3, y: 30, desc: 'Treasure chest' },
            
            // Effects
            { name: 'SPARKLE', x: 0, y: 35, desc: 'Magic sparkle effect' },
            { name: 'SELECTION', x: 1, y: 35, desc: 'Selection highlight' }
        ];
        
        function init() {
            console.log('üé® Initializing Sprite Picker...');
            
            // Get canvas elements
            tilesetCanvas = document.getElementById('tilesetCanvas');
            tilesetCtx = tilesetCanvas.getContext('2d');
            previewCanvas = document.getElementById('previewCanvas');
            previewCtx = previewCanvas.getContext('2d');
            
            // Set image rendering
            tilesetCtx.imageSmoothingEnabled = false;
            previewCtx.imageSmoothingEnabled = false;
            
            // Load tileset
            loadTileset();
            
            // Setup event listeners
            tilesetCanvas.addEventListener('click', onTilesetClick);
            tilesetCanvas.addEventListener('mousemove', onTilesetMouseMove);
            
            // Populate suggestions
            populateSpriteSuggestions();
        }
        
        function loadTileset() {
            console.log('üì¶ Loading tileset...');
            
            tilesetImage = new Image();
            tilesetImage.crossOrigin = 'anonymous';
            
            tilesetImage.onload = function() {
                console.log('‚úÖ Tileset loaded!');
                console.log('üìê Dimensions:', tilesetImage.width, 'x', tilesetImage.height);
                
                updateTilesetInfo();
                renderTileset();
            };
            
            tilesetImage.onerror = function() {
                console.error('‚ùå Failed to load tileset');
                document.getElementById('tilesetInfo').textContent = '‚ùå Failed to load tileset';
            };
            
            tilesetImage.src = TILESET_URL;
        }
        
        function updateTilesetInfo() {
            const cols = Math.floor((tilesetImage.width - OFFSET_X) / TILE_SIZE);
            const rows = Math.floor((tilesetImage.height - OFFSET_Y) / TILE_SIZE);
            
            document.getElementById('tilesetInfo').innerHTML = `
                üìê Image: ${tilesetImage.width} √ó ${tilesetImage.height}px<br>
                üî≤ Tile Size: ${TILE_SIZE}px<br>
                üìç Offset: ${OFFSET_X}, ${OFFSET_Y}px<br>
                üìä Grid: ${cols} √ó ${rows} tiles<br>
                üéØ Total Tiles: ${cols * rows}
            `;
        }
        
        function renderTileset() {
            if (!tilesetImage) return;
            
            const displayWidth = tilesetImage.width * zoom;
            const displayHeight = tilesetImage.height * zoom;
            
            tilesetCanvas.width = displayWidth;
            tilesetCanvas.height = displayHeight;
            
            // Draw the tileset
            tilesetCtx.drawImage(tilesetImage, 0, 0, displayWidth, displayHeight);
            
            // Draw grid
            if (showGrid) {
                drawGrid();
            }
            
            // Draw selection
            if (selectedTileX >= 0 && selectedTileY >= 0) {
                drawSelection(selectedTileX, selectedTileY);
            }
        }
        
        function drawGrid() {
            const cols = Math.floor((tilesetImage.width - OFFSET_X) / TILE_SIZE);
            const rows = Math.floor((tilesetImage.height - OFFSET_Y) / TILE_SIZE);
            
            tilesetCtx.strokeStyle = 'rgba(0, 255, 0, 0.3)';
            tilesetCtx.lineWidth = 1;
            
            // Vertical lines
            for (let x = 0; x <= cols; x++) {
                const screenX = (OFFSET_X + x * TILE_SIZE) * zoom;
                tilesetCtx.beginPath();
                tilesetCtx.moveTo(screenX, 0);
                tilesetCtx.lineTo(screenX, tilesetCanvas.height);
                tilesetCtx.stroke();
            }
            
            // Horizontal lines
            for (let y = 0; y <= rows; y++) {
                const screenY = (OFFSET_Y + y * TILE_SIZE) * zoom;
                tilesetCtx.beginPath();
                tilesetCtx.moveTo(0, screenY);
                tilesetCtx.lineTo(tilesetCanvas.width, screenY);
                tilesetCtx.stroke();
            }
        }
        
        function drawSelection(tileX, tileY) {
            tilesetCtx.strokeStyle = '#FFD700';
            tilesetCtx.lineWidth = 3;
            
            const screenX = (OFFSET_X + tileX * TILE_SIZE) * zoom;
            const screenY = (OFFSET_Y + tileY * TILE_SIZE) * zoom;
            const screenSize = TILE_SIZE * zoom;
            
            tilesetCtx.strokeRect(screenX, screenY, screenSize, screenSize);
        }
        
        function onTilesetClick(e) {
            const rect = tilesetCanvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;
            
            const tileX = Math.floor((mouseX / zoom - OFFSET_X) / TILE_SIZE);
            const tileY = Math.floor((mouseY / zoom - OFFSET_Y) / TILE_SIZE);
            
            // Make sure we're within valid bounds
            if (tileX >= 0 && tileY >= 0) {
                selectTile(tileX, tileY);
            }
        }
        
        function onTilesetMouseMove(e) {
            const rect = tilesetCanvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;
            
            const tileX = Math.floor(mouseX / (TILE_SIZE * zoom));
            const tileY = Math.floor(mouseY / (TILE_SIZE * zoom));
            
            // Update tooltip or status (optional)
        }
        
        function selectTile(tileX, tileY) {
            selectedTileX = tileX;
            selectedTileY = tileY;
            
            // Update coordinate display
            document.getElementById('coordDisplay').textContent = `x: ${tileX}, y: ${tileY}`;
            
            // Update preview
            updatePreview(tileX, tileY);
            
            // Re-render to show selection
            renderTileset();
        }
        
        function updatePreview(tileX, tileY) {
            if (!tilesetImage) return;
            
            previewCtx.clearRect(0, 0, 64, 64);
            
            const sourceX = OFFSET_X + tileX * TILE_SIZE;
            const sourceY = OFFSET_Y + tileY * TILE_SIZE;
            
            // Make sure we don't go out of bounds
            if (sourceX >= 0 && sourceY >= 0 && 
                sourceX + TILE_SIZE <= tilesetImage.width && 
                sourceY + TILE_SIZE <= tilesetImage.height) {
                
                previewCtx.drawImage(
                    tilesetImage,
                    sourceX, sourceY, TILE_SIZE, TILE_SIZE,
                    0, 0, 64, 64
                );
            }
        }
        
        function populateSpriteSuggestions() {
            const container = document.getElementById('spriteSuggestions');
            container.innerHTML = '';
            
            SPRITE_SUGGESTIONS.forEach((sprite, index) => {
                const div = document.createElement('div');
                div.className = 'sprite-suggestion';
                div.innerHTML = `
                    <div class="sprite-name">${sprite.name}</div>
                    <div class="sprite-coord">x: ${sprite.x}, y: ${sprite.y}</div>
                    <div class="sprite-desc">${sprite.desc}</div>
                `;
                
                div.addEventListener('click', () => {
                    selectTile(sprite.x, sprite.y);
                    
                    // Highlight this suggestion
                    document.querySelectorAll('.sprite-suggestion').forEach(s => s.classList.remove('active'));
                    div.classList.add('active');
                });
                
                container.appendChild(div);
            });
        }
        
        function changeZoom(newZoom) {
            zoom = newZoom;
            document.getElementById('zoomLevel').textContent = Math.round(zoom * 100) + '%';
            renderTileset();
        }
        
        function updateTileSize() {
            TILE_SIZE = parseInt(document.getElementById('tileSizeInput').value);
            updateTilesetInfo();
            renderTileset();
        }
        
        function updateOffsets() {
            OFFSET_X = parseInt(document.getElementById('offsetXInput').value) || 0;
            OFFSET_Y = parseInt(document.getElementById('offsetYInput').value) || 0;
            renderTileset();
        }
        
        function resetAlignment() {
            // Try some common offset values automatically
            const commonOffsets = [
                {x: 0, y: 0},   // No offset
                {x: 1, y: 1},   // 1px border
                {x: 2, y: 2},   // 2px border
                {x: 1, y: 0},   // Left border only
                {x: 0, y: 1},   // Top border only
            ];
            
            // For now, just reset to 0,0 but could be made smarter
            OFFSET_X = 0;
            OFFSET_Y = 0;
            document.getElementById('offsetXInput').value = OFFSET_X;
            document.getElementById('offsetYInput').value = OFFSET_Y;
            renderTileset();
            
            alert('üéØ Reset to 0,0. Try adjusting the offset values manually to align the grid with your tiles!');
        }
        
        function toggleGrid() {
            showGrid = document.getElementById('showGridCheckbox').checked;
            renderTileset();
        }
        
        function generateCode() {
            let code = '// Generated TILE_MAP from Sprite Picker\n';
            code += 'const TILE_MAP = {\n';
            
            // Add selected sprites
            if (selectedTileX >= 0 && selectedTileY >= 0) {
                code += `    SELECTED: { x: ${selectedTileX}, y: ${selectedTileY} },\n`;
            }
            
            // Add suggestions that might be useful
            SPRITE_SUGGESTIONS.forEach(sprite => {
                code += `    ${sprite.name}: { x: ${sprite.x}, y: ${sprite.y} }, // ${sprite.desc}\n`;
            });
            
            code += '};';
            
            document.getElementById('codeOutput').value = code;
            
            // Auto-select the text for easy copying
            document.getElementById('codeOutput').select();
        }
        
        // Initialize when page loads
        window.addEventListener('load', init);
    </script>
</body>
</html>
